{
   "_id": "_design/darwincore",
   "_rev": "1-2732152bea2b7eaac8c26f9e0f784c04",
   "language": "javascript",
   "lists": {
       "tsv": "function(head,req) { var headers = ''; var row; start({ 'headers': { 'Content-Type': 'text/tsv' } }); while(row = getRow()) { if (headers == '') { headers='ReferenceID\\tPrimaryTitle\\tCreated\\tURL\\tDOI'; send(headers +'\\n'); } send(row.key + '\\t' + row.value + '\\n'); } }"
   },
   "views": {
       "reference": {
           "map": "function(doc) {\n  var types = ['article','book','chapter'];\n  var type = types.indexOf(doc.type);\n  if (type != -1) \n  {\n     var row = new Array();\n \n     //row.push({\"ReferenceID\": doc._id});\n\n     //row.push({\"PrimaryTitle\": doc.title});\n     row.push(doc.title);\n\n     var year = '';\n     if (doc.year) { year = doc.year; }\n     row.push(year);\n\n     var journal = '';\n     var issn = '';\n     var volume = '';\n     var issue = '';\n     var spage = '';\n     var epage = '';\n     if (doc.journal)\n     {\n        if (doc.journal.name) {\n           journal = doc.journal.name;\n        }\n       if (doc.journal.volume) {\n           volume = doc.journal.volume;\n        }\n       if (doc.journal.issue) {\n           issue = doc.journal.issue;\n        }\n        if (doc.journal.pages) {\n          var startingPage = doc.journal.pages;\n          var delimiter = doc.journal.pages.indexOf('-');\n          if (delimiter != -1) {\n              spage = doc.journal.pages.substring(0, delimiter);\n              epage = doc.journal.pages.substring(delimiter+2);\n          }\n        } \n\n\n\t   if (doc.journal.identifier) {   \n\t\t  for (var i in doc.journal.identifier) {      \n\t\t\t if (doc.journal.identifier[i].type == \"issn\") {\n\t\t\t\tissn = doc.journal.identifier[i].id;\n\t\t\t}\n\t\t  }\n\t   }\n\n\n     }\n\n     row.push(journal);\n     row.push(issn);\n     row.push(volume);\n     row.push(issue);\n     row.push(spage);\n     row.push(epage);\n\n\n \n     // Pick a URL\n     var url = '';\n      if (doc.link)\n       {\n          for (var i in doc.link)\n          {\n            if (doc.link[i].anchor == \"LINK\")\n            {\n               if (doc.link[i].url.match(/biostor.org/))\n               {\n                 url = doc.link[i].url;\n               }\n            }\n          }\n       }\n    row.push(url);\n\n     var doi = '';\n      if (doc.identifier)\n       {\n          for (var i in doc.identifier)\n          {\n            if (doc.identifier[i].type == \"doi\")\n            {\n              doi = 'http://dx.doi.org/' + doc.identifier[i].id;\n            }\n          }\n       }\n\n     //row.push({\"DOI\": doi});\n     row.push(doi);\n\n  \n  \n     emit(doc._id, row.join('\\t'));\n     //emit(doc._id, row);\n  \n  }\n}"
       }
   }
}