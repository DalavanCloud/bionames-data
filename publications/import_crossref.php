<?php

// Import from CrossRef
require_once (dirname(dirname(__FILE__)) . '/adodb5/adodb.inc.php');

require_once (dirname(dirname(__FILE__)). '/couchsimple.php');
require_once (dirname(dirname(__FILE__)) . '/lib.php');

require_once (dirname(__FILE__) . '/reference.php');
require_once (dirname(__FILE__) . '/crossref.php');
require_once (dirname(__FILE__) . '/publication_utils.php');


//--------------------------------------------------------------------------------------------------
$db = NewADOConnection('mysql');
$db->Connect("localhost", 
	'root' , '' , 'ion');

// Ensure fields are (only) indexed by column name
$ADODB_FETCH_MODE = ADODB_FETCH_ASSOC;


$doi = '10.5169/seals-168834'; // non-crossref but some metadata (!)
$doi = '10.1017/S1477200006002003'; // no ISSN
$doi = '10.1016/S1631-0691(02)01488-9';
$doi = '10.1515/mamm.1967.31.2.260';

$doi = '10.1007/BF02684242';

$doi = '10.1071/ZO9550071';

$doi = '10.1186/1471-2148-11-175';


$doi = '10.1016/j.crvi.2013.05.005'; // Resurrection of New Caledonian maskray Neotrygon trigonoides (Myliobatoidei: Dasyatidae) from synonymy with N. kuhlii, based on cytochrome-oxidase I gene sequences and spotting patterns

$doi = '10.1139/z79-251';

// Keys to the Bats (Mammalia: Chiroptera) of East Africa
$doi = '10.3158/2158-5520-12.6.1';

// Chaerephon ansorgei
$doi = '10.1644/1545-1410(2001)660<0001:CA>2.0.CO;2';

$doi = '10.2982/0012-8317(2005)94[213:ROAPSM]2.0.CO;2';
$doi = '10.2982/0012-8317(2005)94[203:SMCITU]2.0.CO;2';
$doi = '10.2982/0012-8317(2005)94[213:ROAPSM]2.0.CO;2';
$doi = '10.1078/1616-5047-00132';
$doi = '10.1017/S136794300500199X';

$doi = '10.2307/1374022';

$doi = '10.1038/241345a0';

$doi = '10.1515/mamm.1968.32.1.64';
$doi = '10.1644/1545-1410(2001)684<0001:VB>2.0.CO;2';

$doi = '10.1163/187631206788831146';
$doi = '10.1111/j.1463-6409.2011.00474.x';
$doi = '10.1126/science.307.5712.1038a';
$doi = '10.1111/j.1096-0031.1996.tb00196.x';
$doi = '10.1111/j.1365-3113.2009.00474.x';

$doi = '10.1515/mamm.1990.54.4.509';
$doi = '10.1515/mamm.1972.36.1.50';

$doi = '10.1186/1742-9994-4-4'; // Frontiers in Zoology


$docs = null;


$dois = array(
'10.1186/1742-9994-4-4',
'10.1098/rstb.2003.1447',
'10.1371/journal.pbio.0020354',
'10.1080/10635150500354886',
'10.1098/rstb.2005.1724',
'10.1073/pnas.0406166101',
'10.1098/rstb.2005.1714',
'10.1073/pnas.0511318103',
'10.1006/mpev.2001.1017',
'10.1038/387138b0',
'10.1046/j.1365-294x.2000.01069.x',
'10.1016/S1055-7903(02)00299-3',
'10.1080/10635150500354878',
'10.1186/1742-9994-2-5'
);

$dois=array('10.3161/001.005.0104');

$dois=array(
'10.2305/IUCN.CH.2001.SSC-AP.1.en',
'10.1515/mamm.1965.29.4.524',
'10.1111/j.1469-7998.1999.tb00771.x'
);

$dois=array('10.1086/277967');

$dois=array(
'10.1016/s0169-5347(02)00041-1',
'10.1098/rsbl.2003.0130',
'10.1098/rspb.2006.3680',
'10.1644/06-mamm-f-038r2.1',
'10.1159/000132371',
'10.1046/j.1472-4642.1998.00012.x'
);

$dois=array(
'10.2307/3504530',
'10.1016/j.mambio.2005.09.001',
'10.1111/j.1439-0469.1994.tb00467.x',
'10.1023/A:1026787515840',
'10.3161/150811008X414782',
'10.3377/004.046.0214',
'10.3161/150811011X578633',
'10.1073/pnas.022477199',
'10.1515/MAMM.2008.015',
'10.3161/001.006.0201',
'10.1126/science.1165115',
'10.2307/1379901',
'10.1644/870.1',
'10.1139/z73-086',
'10.1038/380589a0',
'10.3161/150811010X537963',
'10.1093/molbev/msm076',
'10.2307/3504264',
'10.2307/3504411',
'10.2307/2388908',
'10.3161/001.004.0108',
'10.1554/04-635.1',
'10.1186/1471-2148-7-165',
'10.1242/jeb.01288',
'10.1515/mamm.1957.21.1.1',
'10.2307/3504526',
'10.1078/1616-5047-00166',
'10.2307/3504421',
'10.1644/1545-1410(2005)763[0001:HC]2.0.CO;2',
'10.2307/3504163',
'10.2307/3504441',
'10.2307/3504344',
'10.1515/mamm.1974.38.4.695',
'10.1515/mamm.1986.50.4.507',
'10.1186/1471-2148-11-281'
);

$dois =array('10.3853/j.0067-1975.19.1935.701');

$dois=array('10.1080/00222937900770481');

$dois=array('10.1038/437477a');

$dois=array('10.1643/0045-8511(2001)001[0737:ASSVRM]2.0.CO;2');

$dois=array('10.1080/21564574.2003.9635472');

$dois = array('10.1111/zsc.12016');

$dois=array('10.3897/ijm.5.1865');

$dois=array('10.1111/j.1095-8312.2009.01205.x','10.1111/j.1469-7998.2010.00722.x','10.1038/046514a0','10.1016/j.asd.2006.06.003','10.1093/molbev/msq130','10.1111/j.1096-3642.1995.tb00111.x','10.1111/j.1096-3642.1995.tb00113.x','10.1111/j.1096-3642.1988.tb01361.x','10.1111/j.1096-3642.1988.tb01362.x','10.1111/j.1096-3642.1995.tb00115.x','10.1002/jmor.1050150102','10.1086/279915');

$dois=array('10.1002/zoos.201000005','10.1590/S1984-46702009005000004');

$dois=array('10.3897/zookeys.211.3463');

$dois=array('10.4404/hystrix-19.2-4427');

$dois=array('10.1111/j.1095-8339.1999.tb00491.x');

$dois = array('10.1007/s12225-008-9093-z');

$dois=array('10.1071/IS09047');

$dois=array('10.1071/sb05008','10.1016/s0003-3472(86)80060-4');

$dois=array('10.1080/0022293031000068419','10.1651/c-2532','10.1016/j.ode.2005.09.006');

$dois=array('10.1080/0022293031000068419');

$dois=array('10.1590/S0101-81751983000100001');

$dois=array('10.1111/j.1469-7998.1982.tb03498.x');

$dois=array('10.1111/j.0307-6970.2004.00248.x');

$dois=array('10.1016/j.ympev.2009.03.013');

$dois=array('10.1111/j.1523-1739.2009.01384.x');

$dois=array(
'10.1111/j.1096-3642.1983.tb00526.x',
'10.1111/j.1096-3642.1974.tb01584.x'
);

$dois=array(
'10.1636/Sh06-55.1',
'10.1111/j.1095-8312.2010.01494.x',
'10.1080/00222930802354183',
'10.1071/IS02009'
);

$dois=array('10.1186/1742-9994-4-20');

$dois = array('10.2989/00306520209485348');

$dois=array('10.1111/j.1365-2699.2009.02087.x','10.1111/j.1558-5646.2010.01105.x','10.1016/j.ympev.2005.07.020','10.1016/j.ympev.2006.05.007');

$dois=array('10.1016/j.ympev.2010.01.009');
$dois=array('10.1642/0004-8038(2007)124[561:MSAHBO]2.0.CO;2');

foreach ($dois as $doi)
{
	$reference = get_doi_metadata($doi, $docs);
	
	
	
	//if ($reference)
	{
		$reference->_id = $doi;
		
		get_doi_metadata_unixref($doi, $reference);
		
		get_doi_thumbnail($reference, $doi);
		
		get_doi_pdf($reference, $doi);
		
		$reference->citation_string = reference_to_citation_string($reference);
	
		print_r($reference);
		
		
		
		echo json_encode($reference);
		
		//exit();
		$couch->add_update_or_delete_document($reference,  $reference->_id);
	}
}

?>